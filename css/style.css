:root {
    --focus-blur: 6px;
    --target-color: #6366f1;
    --target-weight: 900;
    --target-style: normal;
}
.custom-slider { -webkit-appearance: none; width: 100%; height: 4px; background: #2d2d35; border-radius: 10px; outline: none; }
.custom-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #6366f1; border: 3px solid #16161a; border-radius: 50%; cursor: pointer; }

#viewport {
    width: 550px; height: 550px;
    background: #fff; position: relative; overflow: hidden;
}


#article-layer {
    width: 4000px; 
    padding: 1000px; 
    line-height: 1.6; 
    color: #1a1a1a;
    background-color: #ffffff; 
    transition: none !important;
    transform-origin: 0 0; 
    position: absolute; 
    top: 0; 
    left: 0;
    /* NEW: Stability Optimizations */
    will-change: transform; /* Moves layer to GPU */
    contain: layout; /* Prevents layout changes from leaking out */
    text-rendering: optimizeLegibility; 
    -webkit-font-smoothing: antialiased;
}
#article-layer h1 { font-size: 80px; font-weight: 900; margin-bottom: 40px; color: #000; }
#article-layer h2 { font-size: 44px; font-weight: 800; margin-top: 60px; margin-bottom: 30px; }
#article-layer p { font-size: 24px; margin-bottom: 24px; max-width: 900px; }

.spotlight-mask {
    position: absolute; inset: 0; pointer-events: none; z-index: 20;
    background: radial-gradient(circle at center, transparent 40px, rgba(0,0,0,0.02) 100px, rgba(0,0,0,0.8) 400px);
    backdrop-filter: blur(var(--focus-blur));
    -webkit-mask-image: radial-gradient(circle at center, transparent 40px, black 220px);
}

/* --- TARGET WORD CUSTOMIZATION --- */

/* Base class: Handles layout and positioning without visual highlighting */
.anchor-target { 
    display: inline-block; 
    position: relative; 
    color: inherit;
    font-weight: inherit;
    font-style: inherit;
}

/* Active class: Only applies styles to the currently focused word */
.anchor-target.active { 
    color: var(--target-color) !important;
    font-weight: var(--target-weight) !important;
    font-style: var(--target-style) !important;
}

/* Updated Marker Styles to only target the active element */
.target-underline .anchor-target.active::after {
    content: ''; position: absolute; bottom: -2px; left: 0; width: 100%; height: 0.15em; 
    background: var(--target-color); border-radius: 2px; opacity: 0.8;
}

.target-brackets .anchor-target.active::before, 
.target-brackets .anchor-target.active::after {
    content: ''; position: absolute; width: 12px; height: 12px; border: 2px solid var(--target-color); opacity: 0.6;
}
.target-brackets .anchor-target.active::before { top: -8px; left: -14px; border-right: 0; border-bottom: 0; }
.target-brackets .anchor-target.active::after { bottom: -8px; right: -14px; border-left: 0; border-top: 0; }

.target-highlight .anchor-target.active {
    background: var(--target-color); color: white !important; padding: 0 6px; border-radius: 0px;
}

/* --- THEMES --- */
.style-midnight #article-layer { background-color: #0a0a0b; color: #e2e8f0; }
.style-midnight #article-layer h1, .style-midnight #article-layer h2 { color: #fff; }
.style-midnight .spotlight-mask { background: radial-gradient(circle at center, transparent 40px, rgba(0,0,0,0.9) 350px); }

.style-terminal #article-layer { 
    background-color: #000; color: #00ff66; 
    font-family: 'JetBrains Mono', monospace !important; 
    background-image: linear-gradient(rgba(0,255,102,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0,255,102,0.05) 1px, transparent 1px);
    background-size: 30px 30px;
}
.style-terminal .spotlight-mask { backdrop-filter: none; background: radial-gradient(circle at center, transparent 60px, rgba(0,0,0,0.4) 400px); }
.style-terminal #viewport { border-color: #00ff66; }

.style-blueprint #article-layer { background-color: #1e3a8a; color: #93c5fd; }
.style-blueprint .spotlight-mask { background: radial-gradient(circle at center, transparent 40px, rgba(30,58,138,0.9) 400px); }

.style-magazine #article-layer { background-color: #fdfbf7; color: #1a1a1a; }
.style-magazine .spotlight-mask { backdrop-filter: grayscale(1) blur(var(--focus-blur)); }
